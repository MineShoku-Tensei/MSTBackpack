name: Build

on:
    pull_request:
        branches:
            - master
        types:
            - opened
            - synchronize
            - reopened
            - ready_for_review
    workflow_dispatch:

env:
    PROJECT_NAME: MSTBackpack
    JAR_REGEX: MSTBackpack-*.jar

permissions:
    contents: read

jobs:
    build:
        if: github.event.pull_request.draft != true
        runs-on: ubuntu-latest

        steps:
            - name: Checkout repository
              uses: actions/checkout@v4
              with:
                  fetch-depth: 0  # needed for git info plugins like git-commit-id-plugin

            - name: Set up Java 21
              uses: actions/setup-java@v4
              with:
                  java-version: '21'
                  distribution: 'temurin'
                  cache: maven

            - name: Build with Maven
              run: mvn -B clean package

            - name: Find built JAR
              run: |
                  jar_file="$(find . -maxdepth 1 -type f -name '${{ env.JAR_REGEX }}' | head -n 1)"
                  if [ -z "$jar_file" ]; then
                    exit 1
                  fi
